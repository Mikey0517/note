import React from "react";import path from "path";import fs from "fs";import { renderToString } from 'react-dom/server';import { StaticRouter } from 'react-router-dom';import { Helmet } from 'react-helmet';import App from "../src/app";const prepHTML = ( data, { html, head, body } ) => {	data = data.replace( '<html', `<html ${ html }` );	data = data.replace( '</head>', `${ head }</head>` );	data = data.replace( '<div id=root></div>', `<div id="root">${ body }</div>` );	return data;}const render = async ( ctx, next ) => {	const filePath = path.resolve( __dirname, '../dist/index.html' );	ctx.type = 'html';	ctx.body = await new Promise( ( resolve, reject ) => {		fs.readFile( filePath , 'utf-8', ( err, htmlData ) => {			if ( err ) {				console.error( '读取文件错误!', err );				resolve( '读取文件错误!' )				return false;			}			const helmet = Helmet.renderStatic();			const context = {};			const app = renderToString(				<StaticRouter context={ context } location={ ctx.path }>					<App/>				</StaticRouter>			);			const html = prepHTML( htmlData, {				html: helmet.htmlAttributes.toString(),				head: helmet.title.toString() + helmet.meta.toString() + helmet.link.toString(),				body: app,			} )			resolve( html )		} )	} )}export default render;